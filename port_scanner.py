import socket
from IPy import IP


def scan(target):
    """
    This function is responsible to send a proper scan request with a given ip.
    :param target: - the given ip / address to scan.
    """
    converted_ip = check_ip(target)
    if str(target) == str(converted_ip):
        print('\n' + '[+] Scanning Target: ' + str(target))
    else:
        print('\n' + '[+] Scanning Target: ' + str(target) + ' : ' + str(converted_ip))
    for port in range(75, 85):
        scan_port(converted_ip, port)


def check_ip(ip_address):
    """
    This function is responsible to check a given ip address and convert it if its not in the correct format.
    :param ip_address: the given ip address.
    :return: the numbers format of the address (i.e. 192.168.1.1)
    """
    try:
        IP(ip_address)
        return ip_address
    except ValueError:
        return socket.gethostbyname(ip_address)


def get_banner(s):
    """
    This function is responsible to return the associated data within a give socket.
    :param s: a given socket.
    :return: the socket banner in 1024 bytes while removing unnecessary chars.
    """
    return s.recv(1024).decode().strip('\n')


def scan_port(ip_address, port):
    """
    This function is responsible to scan and print iff the given port is open within the given ip.
    :param ip_address: the given ip address.
    :param port: the given port.
    """
    try:
        sock = socket.socket()
        sock.settimeout(0.5)
        sock.connect((ip_address, port))
        try:
            banner = get_banner(sock)
            print('[+] Open Port: ' + str(port) + ' : ' + str(banner))

        except:
            print('[+] Open Port: ' + str(port))

    except:
        pass


if __name__ == '__main__':
    targets = input('[+] Enter Target/s to scan (split multiple targets with ,): ')
    if ',' in targets:
        for ip in targets.split(','):
            scan(ip.strip(' '))

    else:
        scan(targets)
